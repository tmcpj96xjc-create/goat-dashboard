<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Goat Herd Growth Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <style>
    :root { --bg:#0b1220; --card:#121a2b; --text:#e7eefc; --muted:#a9b8d6; --line:#223150; }
    body { margin:0; font-family: system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif; background:var(--bg); color:var(--text); }
    .wrap { max-width: 1100px; margin: 0 auto; padding: 18px; }
    h1 { font-size: 20px; margin: 0 0 12px; }
    .grid { display:grid; grid-template-columns: 360px 1fr; gap: 14px; }
    .card { background: var(--card); border: 1px solid var(--line); border-radius: 14px; padding: 14px; }
    .card h2 { margin: 0 0 10px; font-size: 14px; color: var(--muted); font-weight: 600; }
    .row { display:grid; grid-template-columns: 1fr 110px; gap: 10px; align-items:center; padding: 8px 0; border-bottom: 1px dashed rgba(255,255,255,0.06); }
    .row:last-child { border-bottom: none; }
    label { font-size: 12.5px; }
    input[type="number"] { width: 100%; padding: 7px 8px; border-radius: 10px; border: 1px solid var(--line); background: #0e1730; color: var(--text); }
    .small { font-size: 12px; color: var(--muted); line-height: 1.35; }
    .kpis { display:grid; grid-template-columns: repeat(3, 1fr); gap: 10px; margin-bottom: 12px; }
    .kpi { background: #0e1730; border: 1px solid var(--line); border-radius: 14px; padding: 12px; }
    .kpi .t { font-size: 12px; color: var(--muted); }
    .kpi .v { font-size: 18px; margin-top: 6px; font-weight: 700; }
    button { cursor:pointer; padding: 9px 10px; border-radius: 12px; border: 1px solid var(--line); background: #0e1730; color: var(--text); font-weight: 650; }
    button:hover { border-color: rgba(169,184,214,0.8); }
    .actions { display:flex; gap:10px; margin-top: 12px; }
    .tableWrap { overflow:auto; max-height: 360px; border-radius: 12px; border: 1px solid var(--line); }
    table { width: 100%; border-collapse: collapse; min-width: 760px; background:#0e1730; }
    th, td { padding: 8px 10px; border-bottom: 1px solid rgba(255,255,255,0.06); font-size: 12.5px; }
    th { position: sticky; top: 0; background: #101c38; text-align: left; color: var(--muted); }
    @media (max-width: 920px){ .grid { grid-template-columns: 1fr; } }
  </style>
</head>

<body>
  <div class="wrap">
    <h1>Goat Herd Growth Dashboard</h1>

    <div class="grid">
      <div class="card">
        <h2>Inputs</h2>

        <div class="row"><label>Target herd size</label><input id="target" type="number" min="10" step="1" value="200"></div>
        <div class="row"><label>Starting breeding does</label><input id="startDoes" type="number" min="0" step="1" value="4"></div>
        <div class="row"><label>Gestation (months)</label><input id="gest" type="number" min="3" max="7" step="1" value="5"></div>
        <div class="row"><label>Kidding interval (months)</label><input id="kiddingInterval" type="number" min="6" max="18" step="1" value="12"></div>
        <div class="row"><label>Age at first breeding (months)</label><input id="breedAge" type="number" min="6" max="18" step="1" value="10"></div>
        <div class="row"><label>Avg kids per birth</label><input id="kidsPerBirth" type="number" min="1" max="3.5" step="0.1" value="1.8"></div>
        <div class="row"><label>% female kids</label><input id="pctFemale" type="number" min="40" max="60" step="1" value="50"></div>
        <div class="row"><label>Kid survival to weaning (%)</label><input id="kidSurvival" type="number" min="50" max="100" step="1" value="90"></div>
        <div class="row"><label>Adult annual loss (mortality/cull) (%)</label><input id="adultLoss" type="number" min="0" max="25" step="0.5" value="5"></div>
        <div class="row"><label>Sell male kids at weaning? (0–100%)</label><input id="sellMalesPct" type="number" min="0" max="100" step="5" value="90"></div>
        <div class="row"><label>Sell female kids? (0–100%)</label><input id="sellFemalesPct" type="number" min="0" max="100" step="5" value="0"></div>
        <div class="row"><label>Months to simulate</label><input id="monthsSim" type="number" min="12" max="240" step="12" value="120"></div>

        <div class="actions">
          <button id="runBtn">Run simulation</button>
          <button id="resetBtn">Reset</button>
        </div>

        <p class="small" style="margin-top:12px;">
          This is a planning model. It assumes a fixed breeding cycle and applies survival/loss rates.
          If results feel too fast, increase kidding interval, lower kids per birth, or increase losses/sales.
        </p>
      </div>

      <div class="card">
        <h2>Results</h2>

        <div class="kpis">
          <div class="kpi"><div class="t">Time to target</div><div class="v" id="kpiTime">—</div></div>
          <div class="kpi"><div class="t">Peak herd (within simulation)</div><div class="v" id="kpiPeak">—</div></div>
          <div class="kpi"><div class="t">Breeding does at end</div><div class="v" id="kpiDoesEnd">—</div></div>
        </div>

        <div class="card" style="padding:12px; margin-bottom:12px;">
          <canvas id="chart" height="120"></canvas>
          <div class="small" style="margin-top:8px;">Line = total herd. Dashed line = breeding does.</div>
        </div>

        <h2>Monthly breakdown</h2>
        <div class="tableWrap">
          <table id="table">
            <thead>
              <tr>
                <th>Month</th>
                <th>Breeding does</th>
                <th>Does bred</th>
                <th>Kids born</th>
                <th>Female kids kept</th>
                <th>Male kids kept</th>
                <th>Total herd</th>
              </tr>
            </thead>
            <tbody></tbody>
          </table>
        </div>

      </div>
    </div>
  </div>

<script>
  const DEFAULTS = {
    target: 200,
    startDoes: 4,
    gest: 5,
    kiddingInterval: 12,
    breedAge: 10,
    kidsPerBirth: 1.8,
    pctFemale: 50,
    kidSurvival: 90,
    adultLoss: 5,
    sellMalesPct: 90,
    sellFemalesPct: 0,
    monthsSim: 120
  };

  const $ = (id)=> document.getElementById(id);

  function getInputs(){
    const n = (id)=> Number($(id).value);
    return {
      target: n("target"),
      startDoes: n("startDoes"),
      gest: n("gest"),
      kiddingInterval: n("kiddingInterval"),
      breedAge: n("breedAge"),
      kidsPerBirth: n("kidsPerBirth"),
      pctFemale: n("pctFemale")/100,
      kidSurvival: n("kidSurvival")/100,
      adultLossAnnual: n("adultLoss")/100,
      sellMalesPct: n("sellMalesPct")/100,
      sellFemalesPct: n("sellFemalesPct")/100,
      monthsSim: n("monthsSim")
    };
  }

  function simulate(p){
    const months = p.monthsSim;

    let femaleAges = Array(p.breedAge).fill(0);
    let doesBred = Array(months).fill(0);

    let breedingDoes = p.startDoes;
    let totalHerd = p.startDoes;
    let peakHerd = totalHerd;

    doesBred[0] = breedingDoes; // initial breeding event
    const monthlyAdultLoss = p.adultLossAnnual / 12;

    const rows = [];
    let monthHitTarget = null;

    for(let m=0; m<months; m++){
      const adultsLost = breedingDoes * monthlyAdultLoss;
      breedingDoes = Math.max(0, breedingDoes - adultsLost);

      let kidsBorn = 0;
      if (m - p.gest >= 0){
        const bred = doesBred[m - p.gest];
        kidsBorn = bred * p.kidsPerBirth * p.kidSurvival;
      }

      const femaleKids = kidsBorn * p.pctFemale;
      const maleKids = kidsBorn * (1 - p.pctFemale);

      const femaleKept = femaleKids * (1 - p.sellFemalesPct);
      const maleKept = maleKids * (1 - p.sellMalesPct);

      const femalesToBreeders = femaleAges[p.breedAge - 1] || 0;
      for (let a = p.breedAge - 1; a >= 1; a--) femaleAges[a] = femaleAges[a - 1];
      femaleAges[0] = femaleKept;

      breedingDoes += femalesToBreeders;

      if (m + p.kiddingInterval < months){
        doesBred[m + p.kiddingInterval] += breedingDoes;
      }

      totalHerd = Math.max(0, totalHerd - adultsLost + femaleKept + maleKept);

      peakHerd = Math.max(peakHerd, totalHerd);
      if (monthHitTarget === null && totalHerd >= p.target) monthHitTarget = m;

      rows.push({
        month: m,
        breedingDoes,
        doesBred: doesBred[m] || 0,
        kidsBorn,
        femaleKept,
        maleKept,
        totalHerd
      });
    }
    return { rows, monthHitTarget, peakHerd, breedingDoesEnd: rows[rows.length-1]?.breedingDoes ?? breedingDoes };
  }

  function fmt(n){ return (Math.round(n * 10) / 10).toLocaleString(); }

  let chart = null;

  function render(res, p){
    if (res.monthHitTarget === null){
      $("kpiTime").textContent = `Not reached in ${p.monthsSim} months`;
    } else {
      const years = Math.floor(res.monthHitTarget / 12);
      const months = res.monthHitTarget % 12;
      $("kpiTime").textContent = years > 0 ? `${years}y ${months}m` : `${months} months`;
    }
    $("kpiPeak").textContent = fmt(res.peakHerd);
    $("kpiDoesEnd").textContent = fmt(res.breedingDoesEnd);

    const labels = res.rows.map(r => r.month);
    const totals = res.rows.map(r => r.totalHerd);
    const does = res.rows.map(r => r.breedingDoes);

    const ctx = $("chart").getContext("2d");
    if(chart) chart.destroy();

    chart = new Chart(ctx, {
      type: "line",
      data: {
        labels,
        datasets: [
          { label: "Total herd", data: totals, borderWidth: 2, pointRadius: 0, tension: 0.25 },
          { label: "Breeding does", data: does, borderWidth: 2, pointRadius: 0, tension: 0.25, borderDash: [6,4] }
        ]
      },
      options: {
        responsive: true,
        maintainAspectRatio: false,
        plugins: { legend: { labels: { color: "#a9b8d6" } } },
        scales: {
          x: { ticks: { color: "#a9b8d6" }, grid: { color: "rgba(255,255,255,0.05)" } },
          y: { ticks: { color: "#a9b8d6" }, grid: { color: "rgba(255,255,255,0.05)" } }
        }
      }
    });

    const tbody = $("table").querySelector("tbody");
    tbody.innerHTML = "";
    const showRows = Math.min(res.rows.length, 120);
    for(let i=0; i<showRows; i++){
      const r = res.rows[i];
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${r.month}</td>
        <td>${fmt(r.breedingDoes)}</td>
        <td>${fmt(r.doesBred)}</td>
        <td>${fmt(r.kidsBorn)}</td>
        <td>${fmt(r.femaleKept)}</td>
        <td>${fmt(r.maleKept)}</td>
        <td><b>${fmt(r.totalHerd)}</b></td>
      `;
      tbody.appendChild(tr);
    }
  }

  function setDefaults(){
    for (const [k,v] of Object.entries(DEFAULTS)) $(k).value = v;
  }

  function run(){
    const p = getInputs();
    if (p.target <= 0 || p.kiddingInterval <= 0 || p.gest <= 0 || p.breedAge <= 0){
      alert("Please check inputs (must be positive)."); return;
    }
    const res = simulate(p);
    render(res, p);
  }

  $("runBtn").addEventListener("click", run);
  $("resetBtn").addEventListener("click", () => { setDefaults(); run(); });

  setDefaults();
  run();
</script>
</body>
</html>
